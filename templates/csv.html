{% extends 'base.html' %} {% block title %}CSV Upload - shortlist.ai{% endblock
%} {% block content %}
<div class="min-h-screen flex items-center justify-center bg-white px-4 pt-24">
  <div class="flex flex-col items-center w-full max-w-2xl space-y-10">
    <!-- Upload Form -->
    <form
      id="upload-form"
      method="POST"
      enctype="multipart/form-data"
      class="flex flex-col items-center space-y-4 w-full"
    >
      <!-- Listing Name Input -->
      <input
        type="text"
        name="listing_name"
        placeholder="Enter Job Listing Name"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      />

      <!-- Job Description -->
      <textarea
        name="job_description"
        rows="5"
        required
        placeholder="Paste the job description here..."
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
We are looking for a highly motivated Software Engineer to join our backend systems team. As part of a fast-growing startup, you’ll design and build scalable APIs, work with cloud infrastructure, and contribute to our machine learning pipeline. You’ll collaborate with product managers, frontend developers, and data scientists to deliver mission-critical features.

Responsibilities:
Develop and maintain RESTful APIs using Python and Flask
Work with PostgreSQL and Supabase for data modeling and querying
Integrate third-party APIs and optimize backend performance
Collaborate in an Agile environment with frequent sprints and standups
Contribute to CI/CD workflows and write unit/integration tests

Requirements:
Strong proficiency in Python
Experience with cloud platforms like AWS, GCP, or Vercel
Familiarity with SQL databases (PostgreSQL preferred)
Understanding of system design and scalable architecture
Bonus: Exposure to machine learning, LLMs, or vector databases

We’re a remote-first team with flexible hours, equity options, and an opportunity to shape the future of recruiting automation.</textarea
      >

      <!-- File Upload -->
      <input
        type="file"
        name="csvfile"
        id="csvfile"
        accept=".csv"
        class="hidden"
      />
      <label for="csvfile" class="cursor-pointer">
        <img
          src="{{ url_for('static', filename='image/csv.png') }}"
          alt="CSV Icon"
          class="w-36 hover:scale-105 transition-transform duration-200 mx-auto"
        />
        <p class="mt-2 text-sm text-gray-600 text-center">
          Click the icon to select a CSV file
        </p>
      </label>
    </form>

    <!-- Progress Bars -->
    <div id="progress-container" class="w-full space-y-10 hidden">
      <div>
        <p class="text-xl font-semibold text-gray-800 mb-2 text-center">
          Filtering Progress
        </p>
        <div
          class="w-full h-5 bg-gray-200 rounded-full overflow-hidden shadow-inner"
        >
          <div
            class="h-full bg-green-500 rounded-full transition-all duration-500"
            id="filtering-bar"
            style="width: 0%"
          ></div>
        </div>
      </div>
      <div>
        <p class="text-xl font-semibold text-gray-800 mb-2 text-center">
          Background Check Progress
        </p>
        <div
          class="w-full h-5 bg-blue-500 rounded-full transition-all duration-500"
          id="background-bar"
          style="width: 0%"
        ></div>
      </div>
      <div class="w-full flex justify-end mt-4">
        <a
          href="{{ url_for('phone_settings') }}"
          id="next-button"
          class="hidden bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-full shadow-lg transition-transform transform hover:scale-105"
        >
          Next →
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById("csvfile").addEventListener("change", function () {
    const form = document.getElementById("upload-form");
    const formData = new FormData(form);
    document.getElementById("progress-container").classList.remove("hidden");

    // Animate filtering bar to 100% over 3 seconds
    animateBar("filtering-bar", 100, 6000);

    // Upload the form via AJAX
    fetch("/upload", {
      method: "POST",
      body: formData,
    }).then(() => {
      // Poll server until upload is done
      const interval = setInterval(() => {
        fetch("/check_vectors_uploaded")
          .then((res) => res.json())
          .then((data) => {
            if (data.done) {
              clearInterval(interval);
              animateBar("background-bar", 100, 3000);
              setTimeout(() => {
                document
                  .getElementById("next-button")
                  .classList.remove("hidden");
              }, 3200);
            }
          });
      }, 1000);
    });
  });

  function animateBar(id, targetWidth, duration) {
    const bar = document.getElementById(id);
    let width = 0;
    const intervalTime = 20;
    const step = targetWidth / (duration / intervalTime);

    const interval = setInterval(() => {
      if (width >= targetWidth) {
        clearInterval(interval);
      } else {
        width += step;
        bar.style.width = width + "%";
      }
    }, intervalTime);
  }
</script>
{% endblock %}
