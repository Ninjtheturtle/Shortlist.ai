{% extends 'base.html' %}

{% block title %}Call Settings - TalentAI{% endblock %}

{% block content %}
<style>
    .settings-card {
        background-color: rgba(31, 41, 55, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(55, 65, 81, 0.5);
    }
    
    .checkbox-container {
        transition: all 0.2s ease;
    }
    
    .checkbox-container:hover {
        background-color: rgba(17, 24, 39, 0.5);
    }
    
    .question-textarea {
        background-color: rgba(17, 24, 39, 0.5);
        border-color: rgba(55, 65, 81, 0.8);
    }
    
    .question-textarea:focus {
        border-color: rgba(124, 58, 237, 0.8);
    }
    
    .behavioral-textarea {
        border-left: 4px solid rgba(99, 102, 241, 0.8);
    }
    
    .technical-textarea {
        border-left: 4px solid rgba(16, 185, 129, 0.8);
    }
    
    .critical-textarea {
        border-left: 4px solid rgba(139, 92, 246, 0.8);
    }

    /* Parallax effect styles */
    .parallax-circle {
        position: absolute;
        will-change: transform;
        transition: transform 0.1s linear;
        border-radius: 50%;
        filter: blur(3rem);
    }
</style>

<div class="min-h-screen bg-gray-900 pt-24 pb-12 px-4 relative overflow-hidden">
    <!-- Background Gradient Circles with parallax effect -->
    <div id="circle1" class="parallax-circle -top-20 -left-20 w-96 h-96 bg-indigo-900 opacity-15 z-0" data-speed="0.2"></div>
    <div id="circle2" class="parallax-circle bottom-1/3 right-0 w-72 h-72 bg-purple-900 opacity-25 z-0" data-speed="0.5"></div>
    <div id="circle3" class="parallax-circle top-1/4 left-1/3 w-64 h-64 bg-blue-900 opacity-20 z-0" data-speed="0.3"></div>
    <div id="circle4" class="parallax-circle bottom-0 right-1/4 w-80 h-80 bg-pink-900 opacity-20 z-0" data-speed="0.4"></div>

    <div class="max-w-3xl mx-auto relative z-10">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-3xl font-bold text-white mb-3">Call Customization Settings</h1>
            <p class="text-gray-400 max-w-lg mx-auto">
                Configure your AI interview preferences and customize the questions
            </p>
        </div>
        
        <!-- Settings Card -->
        <form class="settings-card rounded-xl p-8 shadow-lg space-y-8">
            <!-- Checkboxes Section -->
            <div>
                <h2 class="text-xl font-semibold text-white mb-6 pb-2 border-b border-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2 text-indigo-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                    </svg> 
                    Interview Preferences
                </h2>
                
                <div class="space-y-4">
                    <label class="checkbox-container flex items-start p-4 rounded-lg cursor-pointer">
                        <div class="flex items-center h-5">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600 bg-gray-800 border-gray-600 rounded focus:ring-indigo-500">
                        </div>
                        <div class="ml-3 text-sm">
                            <span class="font-medium text-gray-300">Record call transcript</span>
                            <p class="text-gray-500 mt-1">Full conversation will be available in your dashboard</p>
                        </div>
                    </label>
                    
                    <label class="checkbox-container flex items-start p-4 rounded-lg cursor-pointer">
                        <div class="flex items-center h-5">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600 bg-gray-800 border-gray-600 rounded focus:ring-indigo-500" checked>
                        </div>
                        <div class="ml-3 text-sm">
                            <span class="font-medium text-gray-300">Disclose AI interviewer</span>
                            <p class="text-gray-500 mt-1">Candidate will be informed this is an automated call</p>
                        </div>
                    </label>
                    
                    <label class="checkbox-container flex items-start p-4 rounded-lg cursor-pointer" checked>
                        <div class="flex items-center h-5">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600 bg-gray-800 border-gray-600 rounded focus:ring-indigo-500" checked>
                        </div>
                        <div class="ml-3 text-sm">
                            <span class="font-medium text-gray-300">Include feedback scoring</span>
                            <p class="text-gray-500 mt-1">Candidate will receive automated performance analysis</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <div>
                <h2 class="text-xl font-semibold text-white mb-6 pb-2 border-b border-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2 text-indigo-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                    </svg>
                    Customize Questions
                </h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block mb-3 text-gray-300 font-medium">
                            <span class="bg-indigo-900 bg-opacity-50 px-2 py-1 rounded-md text-indigo-300 text-sm">Behavioral</span>
                        </label>
                        <textarea 
                            id="behavioral"
                            class="question-textarea behavioral-textarea w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-gray-500"
                            rows="3"
                        >{{ behavioral_q }}</textarea>
                    </div>
                    
                    <div>
                        <label class="block mb-3 text-gray-300 font-medium">
                            <span class="bg-green-900 bg-opacity-50 px-2 py-1 rounded-md text-green-300 text-sm">Technical</span>
                        </label>
                        <textarea 
                            id="technical"
                            class="question-textarea technical-textarea w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white placeholder-gray-500"
                            rows="3"
                        >{{ technical_q }}</textarea>
                    </div>
                    
                    <div>
                        <label class="block mb-3 text-gray-300 font-medium">
                            <span class="bg-purple-900 bg-opacity-50 px-2 py-1 rounded-md text-purple-300 text-sm">Critical Thinking</span>
                        </label>
                        <textarea 
                            id="critical"
                            class="question-textarea critical-textarea w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-white placeholder-gray-500"
                            rows="3"
                        >{{ critical_q }}</textarea>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between pt-6">
                <a href="{{ url_for('csv_page') }}" class="flex items-center px-6 py-3 rounded-lg border border-gray-600 text-gray-300 hover:text-white hover:border-indigo-500 hover:bg-gray-700 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    Back    
                </a>
                
                <button type="submit" onclick="submitQuestions()" class="flex items-center px-6 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition-colors duration-200">
                    Save Settings
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </form>
    </div>
</div>

<script>

// Parallax effect for gradient circles
document.addEventListener('DOMContentLoaded', function() {
    const circles = document.querySelectorAll('.parallax-circle');
    
    window.addEventListener('scroll', function() {
        const scrollPosition = window.pageYOffset;
        
        circles.forEach(circle => {
            const speed = parseFloat(circle.getAttribute('data-speed'));
            const yPos = -(scrollPosition * speed);
            
            // Apply the transform with the calculated position
            circle.style.transform = `translate3d(0, ${yPos}px, 0)`;
        });
    }); // Added missing closing for scroll event listener
});

function submitQuestions() {
    const questions = [
        document.getElementById("behavioral").value,
        document.getElementById("technical").value,
        document.getElementById("critical").value,
    ];

    fetch("/phone_settings", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ questions: questions }),
    }).then((res) => {
        if (res.ok) {
            // Initiate actual Twilio call before redirect
            fetch("/initiate_fake_call", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ listingID: "{{ job.job_id }}" }),
            }).then(() => {
                window.location.href = "{{ url_for('phone_list') }}";
            });
        } else {
            alert("Failed to save questions. Try again.");
        }
    });
}

</script>

{% endblock %}