{% extends 'base.html' %} {% block title %}Phone Settings - shortlist.ai{%
endblock %} {% block content %}
<div
  class="min-h-screen bg-white px-6 py-24 flex flex-col items-center space-y-12"
>
  <!-- Settings Header -->
  <h1 class="text-3xl font-bold text-center text-gray-800">
    Call Customization Settings
  </h1>

  <!-- Checkboxes & Questions Form -->
  <form class="w-full max-w-2xl space-y-6">
    <!-- Checkboxes -->
    <div class="space-y-4">
      <label class="flex items-center space-x-3">
        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" />
        <span class="text-lg text-gray-800"
          >Do you want the transcript of the call to be recorded?</span
        >
      </label>
      <label class="flex items-center space-x-3">
        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" />
        <span class="text-lg text-gray-800"
          >Do you want the person interviewed to know this is an AI call?</span
        >
      </label>
      <label class="flex items-center space-x-3">
        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" />
        <span class="text-lg text-gray-800"
          >Do you want to include post-call feedback scoring?</span
        >
      </label>
    </div>

    <h2 class="text-2xl font-semibold text-gray-900 pt-12">
      Edit Interview Questions
    </h2>

    <div class="space-y-6">
      <div>
        <label class="block mb-2 text-gray-700 font-medium"
          >Behavioural Question</label
        >
        <textarea class="question-field" id="behavioral" rows="3">
{{ behavioral_q }}</textarea
        >
      </div>

      <div>
        <label class="block mb-2 text-gray-700 font-medium"
          >Technical Question</label
        >
        <textarea class="question-field" id="technical" rows="3">
{{ technical_q }}</textarea
        >
      </div>

      <div>
        <label class="block mb-2 text-gray-700 font-medium"
          >Critical Thinking Question</label
        >
        <textarea class="question-field" id="critical" rows="3">
{{ critical_q }}</textarea
        >
      </div>
    </div>

    <!-- Right-Aligned Next Button -->
    <div class="w-full flex justify-end pt-6">
      <button
        type="button"
        onclick="submitQuestions()"
        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-full shadow-lg transition-transform transform hover:scale-105"
      >
        Begin Phone Screens â†’
      </button>
    </div>
  </form>

  <script>
    function submitQuestions() {
      const questions = [
        document.getElementById("behavioral").value,
        document.getElementById("technical").value,
        document.getElementById("critical").value,
      ];

      // Save questions first
      fetch("/phone_settings", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ questions: questions }),
      }).then((res) => {
        if (res.ok) {
          // Only call initiate_fake_call ONCE, then redirect
          fetch("/initiate_fake_call", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ listingID: "{{ job.job_id }}" }),
          }).then(() => {
            window.location.href = "{{ url_for('phone_list') }}";
          });
        } else {
          alert("Failed to save questions. Try again.");
        }
      });
    }
  </script>
</div>
{% endblock %}
