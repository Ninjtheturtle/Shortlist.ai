{% extends 'base.html' %} {% block title %}Phone List - shortlist.ai{% endblock
%} {% block content %}
<div class="min-h-screen bg-white px-8 md:px-20 py-20">
  <h1 class="text-3xl font-bold text-center mb-10">Interviewed Applicants</h1>

  <div class="overflow-x-auto">
    <table class="w-full border border-black text-left">
      <thead>
        <tr class="bg-gray-100">
          <th class="border border-black px-4 py-2">Name</th>
          <th class="border border-black px-4 py-2">LinkedIn Link</th>
          <th class="border border-black px-4 py-2">Resume Link</th>
          <th class="border border-black px-4 py-2">Status</th>
          <th class="border border-black px-4 py-2">Score</th>
        </tr>
      </thead>

      <tbody>
        {% for applicant in applicants %}
        <tr>
          <td>{{ applicant.name }}</td>
          <td>
            <a href="{{ applicant.linkedin }}" target="_blank"
              >{{ applicant.linkedin }}</a
            >
          </td>
          <td>{{ applicant.resume_link }}</td>
          <td class="text-center">
            <img
              id="status-{{ loop.index0 }}"
              src="/static/image/csv.png"
              class="w-6 mx-auto"
            />
          </td>
          <td class="text-center">N/A</td>
        </tr>
        <tr id="details-{{ loop.index0 }}" class="hidden">
          <td colspan="5">
            <p>
              <strong>Start Time:</strong>
              <span id="start-{{ loop.index0 }}">...</span>
            </p>
            <p>
              <strong>End Time:</strong>
              <span id="end-{{ loop.index0 }}">...</span>
            </p>
            <p><strong>Transcript:</strong></p>
            <div id="transcript-{{ loop.index0 }}">
              Generating transcript...
            </div>
          </td>
        </tr>

        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  async function fetchStatus(email, index) {
    const response = await fetch(`/call_status_poll?email=${email}`);
    const data = await response.json();

    if (data.status === "done") {
      document.getElementById(`status-${index}`).src =
        "/static/image/check.png";
      document.getElementById(`transcript-${index}`).innerText =
        data.transcript;
      document.getElementById(`start-${index}`).innerText = data.start_time;
      document.getElementById(`end-${index}`).innerText = data.end_time;
    } else {
      setTimeout(() => fetchStatus(email, index), 3000); // retry
    }
  }
</script>

<script>
  function toggleDetails(index) {
    const row = document.getElementById(`details-${index}`);
    row.classList.toggle("hidden");
  }
</script>
{% endblock %}
